---
layout: post
title: 简单试用Skynet
categories: [general]
tags: [c]
---

公司立了个新项目，让我设计下服务器端，趁机尝试一下skynet。

## 为何要尝试skynet ##
1. 工作需要：目前我们服务器的拓扑结构是使用多进程单线程的结构，按照一定得规则将玩家分摊到不同的进程，碰到领土战类似的大量玩家聚集单张地图的PVP活动，会造成单进程压力很大，但又很难再次拆分。
1. 个人需要：我熟悉剑三、剑世、逍遥江湖这几款金山系游戏服务器结构，但对于其他公司的做法了解不深，幸好skynet开源，其性能也得到了市场充分的检验，是非常好的学习资源。

## 目标 ##
我和[dinghim]抽一些非工作时间，将现有手游的服务端的部分功能使用skynet驱动起来，实现与客户端完成基本的交互。包括：创建角色，游戏角色登陆，完成简单的游戏功能（探索功能）。
[计划及进展](https://github.com/dpull/skynet_demo/issues)

## 简单介绍Skynet ##
Skynet是多线程的消息分发系统。
其脚本扩展利用了lua的协程，将一些异步操作抽象为了同步操作，使代码逻辑能更清晰一些，但从查bug的角度来看，这样做未必是好事。

举个例子：
加载玩家数据，我们现在的做法是，有两条协议，一条是请求加载，一条是加载成功的回调，需要实现两个函数，skynet使用协程将其隐藏， 请求加载时，当前协程挂起，成功回调后，将其恢复。


## 对比 ##

    
    比较 				| GameCenter+多个GameServer 		| Skynet 		| 备注
    ---  				| --- 							| ---           | ---
    培训成本 			| -				                | -             | 无差别（都是新人）
    遇到问题解决成本    	| √				                |               | 几个项目的技术负责人都挺熟这套
    承载量    	        | 				                | √             | 理论上应当会高一些，至少负载均衡了
    业务逻辑的开发速度    | 				                | √             | 通过一些代码糖将异步改为了同步
    性能优化程度          | 				                | √             | 理论上所有耗时操作都采用异步会好拆分一些，我们以前的服务器大部分拆不开 


[acai]: http://github.com/dpull
[dinghim]: https://github.com/dinghim